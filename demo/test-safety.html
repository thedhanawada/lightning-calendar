<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Safety Test - Command Parser</title>
</head>
<body>
    <h1>SafeCommandParser Test</h1>
    <div id="results"></div>

    <script type="module">
        import { SafeCommandParser } from './js/SafeCommandParser.js';

        // Mock calendar for testing
        const mockCalendar = {
            getEvents: () => ['Event1', 'Event2'],
            setView: (view) => `View set to ${view}`,
            getView: () => 'month',
            eventStore: {
                getStats: () => ({ totalEvents: 2 })
            }
        };

        const parser = new SafeCommandParser({
            calendar: mockCalendar
        });

        const results = document.getElementById('results');

        // Test cases
        const tests = [
            {
                name: 'Safe command',
                command: 'calendar.getEvents()',
                shouldPass: true
            },
            {
                name: 'Block eval()',
                command: 'eval("alert(1)")',
                shouldPass: false
            },
            {
                name: 'Block document access',
                command: 'document.cookie',
                shouldPass: false
            },
            {
                name: 'Block script injection',
                command: '<script>alert(1)</script>',
                shouldPass: false
            },
            {
                name: 'Block Function constructor',
                command: 'new Function("alert(1)")',
                shouldPass: false
            },
            {
                name: 'Safe method with args',
                command: "calendar.setView('week')",
                shouldPass: true
            },
            {
                name: 'Block localStorage',
                command: 'localStorage.setItem("test", "value")',
                shouldPass: false
            },
            {
                name: 'Block fetch',
                command: 'fetch("http://evil.com")',
                shouldPass: false
            }
        ];

        let passed = 0;
        let failed = 0;

        tests.forEach(test => {
            const div = document.createElement('div');
            try {
                const result = parser.execute(test.command);
                if (test.shouldPass) {
                    div.innerHTML = `‚úÖ ${test.name}: PASSED (Result: ${JSON.stringify(result)})`;
                    div.style.color = 'green';
                    passed++;
                } else {
                    div.innerHTML = `‚ùå ${test.name}: FAILED - Should have been blocked!`;
                    div.style.color = 'red';
                    failed++;
                }
            } catch (error) {
                if (!test.shouldPass) {
                    div.innerHTML = `‚úÖ ${test.name}: PASSED (Blocked as expected)`;
                    div.style.color = 'green';
                    passed++;
                } else {
                    div.innerHTML = `‚ùå ${test.name}: FAILED - ${error.message}`;
                    div.style.color = 'red';
                    failed++;
                }
            }
            results.appendChild(div);
        });

        // Summary
        const summary = document.createElement('h2');
        summary.innerHTML = `Test Results: ${passed} passed, ${failed} failed`;
        summary.style.color = failed === 0 ? 'green' : 'red';
        results.appendChild(summary);

        if (failed === 0) {
            const success = document.createElement('p');
            success.innerHTML = 'üéâ All security tests passed! The SafeCommandParser is working correctly.';
            success.style.color = 'green';
            success.style.fontWeight = 'bold';
            results.appendChild(success);
        }
    </script>
</body>
</html>