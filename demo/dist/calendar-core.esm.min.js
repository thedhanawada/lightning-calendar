class e{constructor(){this.timezones={UTC:{offset:0,dst:null},GMT:{offset:0,dst:null},"Africa/Abidjan":{offset:0,dst:null},"Africa/Accra":{offset:0,dst:null},"Africa/Addis_Ababa":{offset:180,dst:null},"Africa/Algiers":{offset:60,dst:null},"Africa/Cairo":{offset:120,dst:null},"Africa/Casablanca":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Africa/Johannesburg":{offset:120,dst:null},"Africa/Lagos":{offset:60,dst:null},"Africa/Nairobi":{offset:180,dst:null},"America/Anchorage":{offset:-540,dst:{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:60}},"America/Argentina/Buenos_Aires":{offset:-180,dst:null},"America/Bogota":{offset:-300,dst:null},"America/Caracas":{offset:-240,dst:null},"America/Chicago":{offset:-360,dst:{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:60}},"America/Denver":{offset:-420,dst:{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:60}},"America/Detroit":{offset:-300,dst:{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:60}},"America/Halifax":{offset:-240,dst:{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:60}},"America/Los_Angeles":{offset:-480,dst:{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:60}},"America/Mexico_City":{offset:-360,dst:{start:{month:4,week:1,day:0},end:{month:10,week:-1,day:0},offset:60}},"America/New_York":{offset:-300,dst:{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:60}},"America/Phoenix":{offset:-420,dst:null},"America/Regina":{offset:-360,dst:null},"America/Santiago":{offset:-180,dst:{start:{month:9,week:1,day:0},end:{month:4,week:1,day:0},offset:60}},"America/Sao_Paulo":{offset:-180,dst:{start:{month:10,week:3,day:0},end:{month:2,week:3,day:0},offset:60}},"America/St_Johns":{offset:-210,dst:{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:60}},"America/Toronto":{offset:-300,dst:{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:60}},"America/Vancouver":{offset:-480,dst:{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:60}},"Asia/Baghdad":{offset:180,dst:null},"Asia/Bangkok":{offset:420,dst:null},"Asia/Dubai":{offset:240,dst:null},"Asia/Hong_Kong":{offset:480,dst:null},"Asia/Jakarta":{offset:420,dst:null},"Asia/Jerusalem":{offset:120,dst:{start:{month:3,week:-1,day:5},end:{month:10,week:-1,day:0},offset:60}},"Asia/Karachi":{offset:300,dst:null},"Asia/Kolkata":{offset:330,dst:null},"Asia/Kuala_Lumpur":{offset:480,dst:null},"Asia/Manila":{offset:480,dst:null},"Asia/Seoul":{offset:540,dst:null},"Asia/Shanghai":{offset:480,dst:null},"Asia/Singapore":{offset:480,dst:null},"Asia/Taipei":{offset:480,dst:null},"Asia/Tehran":{offset:210,dst:{start:{month:3,week:4,day:0},end:{month:9,week:4,day:0},offset:60}},"Asia/Tokyo":{offset:540,dst:null},"Atlantic/Azores":{offset:-60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Atlantic/Bermuda":{offset:-240,dst:{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:60}},"Atlantic/Reykjavik":{offset:0,dst:null},"Australia/Adelaide":{offset:570,dst:{start:{month:10,week:1,day:0},end:{month:4,week:1,day:0},offset:60}},"Australia/Brisbane":{offset:600,dst:null},"Australia/Darwin":{offset:570,dst:null},"Australia/Hobart":{offset:600,dst:{start:{month:10,week:1,day:0},end:{month:4,week:1,day:0},offset:60}},"Australia/Melbourne":{offset:600,dst:{start:{month:10,week:1,day:0},end:{month:4,week:1,day:0},offset:60}},"Australia/Perth":{offset:480,dst:null},"Australia/Sydney":{offset:600,dst:{start:{month:10,week:1,day:0},end:{month:4,week:1,day:0},offset:60}},"Europe/Amsterdam":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Athens":{offset:120,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Berlin":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Brussels":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Budapest":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Copenhagen":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Dublin":{offset:0,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Helsinki":{offset:120,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Istanbul":{offset:180,dst:null},"Europe/Kiev":{offset:120,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Lisbon":{offset:0,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/London":{offset:0,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Madrid":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Moscow":{offset:180,dst:null},"Europe/Oslo":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Paris":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Prague":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Rome":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Stockholm":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Vienna":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Warsaw":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Europe/Zurich":{offset:60,dst:{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:60}},"Indian/Maldives":{offset:300,dst:null},"Indian/Mauritius":{offset:240,dst:null},"Pacific/Auckland":{offset:720,dst:{start:{month:9,week:-1,day:0},end:{month:4,week:1,day:0},offset:60}},"Pacific/Fiji":{offset:720,dst:{start:{month:11,week:1,day:0},end:{month:1,week:3,day:0},offset:60}},"Pacific/Guam":{offset:600,dst:null},"Pacific/Honolulu":{offset:-600,dst:null},"Pacific/Midway":{offset:-660,dst:null},"Pacific/Noumea":{offset:660,dst:null},"Pacific/Pago_Pago":{offset:-660,dst:null},"Pacific/Port_Moresby":{offset:600,dst:null},"Pacific/Tahiti":{offset:-600,dst:null}},this.aliases={EST:"America/New_York",EDT:"America/New_York",CST:"America/Chicago",CDT:"America/Chicago",MST:"America/Denver",MDT:"America/Denver",PST:"America/Los_Angeles",PDT:"America/Los_Angeles",AKST:"America/Anchorage",AKDT:"America/Anchorage",HST:"Pacific/Honolulu",AST:"America/Halifax",ADT:"America/Halifax",NST:"America/St_Johns",NDT:"America/St_Johns",BST:"Europe/London",IST:"Asia/Kolkata",WET:"Europe/Lisbon",WEST:"Europe/Lisbon",CET:"Europe/Paris",CEST:"Europe/Paris",EET:"Europe/Athens",EEST:"Europe/Athens",MSK:"Europe/Moscow",JST:"Asia/Tokyo",KST:"Asia/Seoul",CST_CN:"Asia/Shanghai",HKT:"Asia/Hong_Kong",SGT:"Asia/Singapore",AEST:"Australia/Sydney",AEDT:"Australia/Sydney",ACST:"Australia/Adelaide",ACDT:"Australia/Adelaide",AWST:"Australia/Perth",NZST:"Pacific/Auckland",NZDT:"Pacific/Auckland","US/Eastern":"America/New_York","US/Central":"America/Chicago","US/Mountain":"America/Denver","US/Pacific":"America/Los_Angeles","US/Alaska":"America/Anchorage","US/Hawaii":"Pacific/Honolulu","Canada/Eastern":"America/Toronto","Canada/Central":"America/Regina","Canada/Mountain":"America/Denver","Canada/Pacific":"America/Vancouver","Canada/Atlantic":"America/Halifax","Canada/Newfoundland":"America/St_Johns","Mexico/General":"America/Mexico_City","Brazil/East":"America/Sao_Paulo","Chile/Continental":"America/Santiago",GB:"Europe/London","GB-Eire":"Europe/London",Eire:"Europe/Dublin",Israel:"Asia/Jerusalem",Japan:"Asia/Tokyo",Singapore:"Asia/Singapore",Hongkong:"Asia/Hong_Kong",ROK:"Asia/Seoul",PRC:"Asia/Shanghai","Australia/NSW":"Australia/Sydney","Australia/Victoria":"Australia/Melbourne","Australia/Queensland":"Australia/Brisbane","Australia/South":"Australia/Adelaide","Australia/Tasmania":"Australia/Hobart","Australia/West":"Australia/Perth","Australia/North":"Australia/Darwin",NZ:"Pacific/Auckland"}}getTimezone(e){return this.aliases[e]&&(e=this.aliases[e]),this.timezones[e]||null}getAllTimezones(){return Object.keys(this.timezones)}isValidTimezone(e){return void 0!==this.aliases[e]||void 0!==this.timezones[e]}resolveAlias(e){return this.aliases[e]||e}getTimezonesByOffset(e){return Object.entries(this.timezones).filter(([t,s])=>s.offset===e).map(([e,t])=>e)}getCommonTimezones(){return{Americas:["America/New_York","America/Chicago","America/Denver","America/Los_Angeles","America/Toronto","America/Mexico_City","America/Sao_Paulo"],Europe:["Europe/London","Europe/Paris","Europe/Berlin","Europe/Moscow","Europe/Rome","Europe/Madrid","Europe/Amsterdam"],Asia:["Asia/Tokyo","Asia/Shanghai","Asia/Hong_Kong","Asia/Singapore","Asia/Kolkata","Asia/Dubai","Asia/Seoul"],"Australia/Pacific":["Australia/Sydney","Australia/Melbourne","Australia/Brisbane","Australia/Perth","Pacific/Auckland","Pacific/Honolulu"],Africa:["Africa/Cairo","Africa/Lagos","Africa/Johannesburg","Africa/Nairobi"]}}}class t{constructor(){this.database=new e,this.offsetCache=new Map,this.dstCache=new Map,this.maxCacheSize=1e3,this.cacheHits=0,this.cacheMisses=0}convertTimezone(e,t,s){if(!e)return null;if(t===s)return new Date(e);const i=this.getTimezoneOffset(e,t),a=60*(this.getTimezoneOffset(e,s)-i)*1e3;return new Date(e.getTime()+a)}toUTC(e,t){if(!e)return null;if("UTC"===t)return new Date(e);const s=this.getTimezoneOffset(e,t);return new Date(e.getTime()-60*s*1e3)}fromUTC(e,t){if(!e)return null;if("UTC"===t)return new Date(e);const s=this.getTimezoneOffset(e,t);return new Date(e.getTime()+60*s*1e3)}getTimezoneOffset(e,t){const s=`${t=this.database.resolveAlias(t)}_${e.getFullYear()}_${e.getMonth()}_${e.getDate()}`;if(this.offsetCache.has(s))return this.cacheHits++,this._manageCacheSize(),this.offsetCache.get(s);if(this.cacheMisses++,"undefined"!=typeof Intl&&Intl.DateTimeFormat)try{const i=new Intl.DateTimeFormat("en-US",{timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(e),a=(new Date(i.find(e=>"year"===e.type).value,i.find(e=>"month"===e.type).value-1,i.find(e=>"day"===e.type).value,i.find(e=>"hour"===e.type).value,i.find(e=>"minute"===e.type).value,i.find(e=>"second"===e.type).value).getTime()-e.getTime())/6e4;return this.offsetCache.set(s,-a),this._manageCacheSize(),-a}catch(e){}const i=this.database.getTimezone(t);if(!i)throw new Error(`Unknown timezone: ${t}`);let a=i.offset;return i.dst&&this.isDST(e,t,i.dst)&&(a+=i.dst.offset),this.offsetCache.set(s,a),this._manageCacheSize(),a}isDST(e,t,s=null){if(!s){const e=this.database.getTimezone(t);if(!e||!e.dst)return!1;s=e.dst}const i=e.getFullYear(),a=this.getNthWeekdayOfMonth(i,s.start.month,s.start.week,s.start.day),n=this.getNthWeekdayOfMonth(i,s.end.month,s.end.week,s.end.day);return a>n?e>=a||e<n:e>=a&&e<n}getNthWeekdayOfMonth(e,t,s,i){const a=new Date(e,t,1);let n=i-a.getDay();if(n<0&&(n+=7),s>0)a.setDate(1+n+7*(s-1));else{const n=new Date(e,t+1,0).getDate();a.setDate(n);let r=a.getDay()-i;r<0&&(r+=7),a.setDate(n-r+7*(s+1))}return a}getCommonTimezones(){const e=new Date;return[{value:"America/New_York",label:"Eastern Time (New York)",region:"Americas"},{value:"America/Chicago",label:"Central Time (Chicago)",region:"Americas"},{value:"America/Denver",label:"Mountain Time (Denver)",region:"Americas"},{value:"America/Phoenix",label:"Mountain Time - Arizona (Phoenix)",region:"Americas"},{value:"America/Los_Angeles",label:"Pacific Time (Los Angeles)",region:"Americas"},{value:"America/Anchorage",label:"Alaska Time (Anchorage)",region:"Americas"},{value:"Pacific/Honolulu",label:"Hawaii Time (Honolulu)",region:"Pacific"},{value:"America/Toronto",label:"Eastern Time (Toronto)",region:"Americas"},{value:"America/Vancouver",label:"Pacific Time (Vancouver)",region:"Americas"},{value:"America/Mexico_City",label:"Central Time (Mexico City)",region:"Americas"},{value:"America/Sao_Paulo",label:"Brasilia Time (SÃ£o Paulo)",region:"Americas"},{value:"Europe/London",label:"GMT/BST (London)",region:"Europe"},{value:"Europe/Paris",label:"Central European Time (Paris)",region:"Europe"},{value:"Europe/Berlin",label:"Central European Time (Berlin)",region:"Europe"},{value:"Europe/Moscow",label:"Moscow Time",region:"Europe"},{value:"Asia/Dubai",label:"Gulf Time (Dubai)",region:"Asia"},{value:"Asia/Kolkata",label:"India Time (Mumbai)",region:"Asia"},{value:"Asia/Shanghai",label:"China Time (Shanghai)",region:"Asia"},{value:"Asia/Tokyo",label:"Japan Time (Tokyo)",region:"Asia"},{value:"Asia/Seoul",label:"Korea Time (Seoul)",region:"Asia"},{value:"Asia/Singapore",label:"Singapore Time",region:"Asia"},{value:"Australia/Sydney",label:"Australian Eastern Time (Sydney)",region:"Oceania"},{value:"Australia/Melbourne",label:"Australian Eastern Time (Melbourne)",region:"Oceania"},{value:"Pacific/Auckland",label:"New Zealand Time (Auckland)",region:"Oceania"},{value:"UTC",label:"UTC",region:"UTC"}].map(t=>{const s=this.getTimezoneOffset(e,t.value),i=-s/60,a=Math.floor(Math.abs(i)),n=Math.round(60*Math.abs(i%1)),r=`UTC${i>=0?"+":"-"}${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`;return{...t,offset:r,offsetMinutes:-s}}).sort((e,t)=>e.offsetMinutes-t.offsetMinutes)}formatInTimezone(e,t,s={}){if(!e)return"";const i={...{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:t},...s};try{return new Intl.DateTimeFormat("en-US",i).format(e)}catch(i){return this.fromUTC(this.toUTC(e,"UTC"),t).toLocaleString("en-US",s)}}getSystemTimezone(){if("undefined"!=typeof Intl&&Intl.DateTimeFormat)try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}const e=-(new Date).getTimezoneOffset()/60;for(const[t,s]of Object.entries(this.timezoneOffsets))if(s===e)return t;return"UTC"}parseTimezone(e){if(!e)return"UTC";if(this.timezoneOffsets.hasOwnProperty(e))return e;const t=e.toUpperCase();if(this.timezoneAbbreviations.hasOwnProperty(t))return this.timezoneAbbreviations[t];const s=e.match(/^([+-])(\d{2}):?(\d{2})$/);if(s){const e=("+"===s[1]?1:-1)*(parseInt(s[2],10)+parseInt(s[3],10)/60);for(const[t,s]of Object.entries(this.timezoneOffsets))if(s===e)return t}return"UTC"}getTimezoneDifference(e,t,s=new Date){const i=this.getTimezoneOffset(s,e);return(this.getTimezoneOffset(s,t)-i)/60}clearCache(){this.offsetCache.clear(),this.dstCache.clear(),this.cacheHits=0,this.cacheMisses=0}isValidTimezone(e){return this.database.isValidTimezone(e)}getCacheStats(){const e=this.cacheHits+this.cacheMisses>0?(this.cacheHits/(this.cacheHits+this.cacheMisses)*100).toFixed(2):0;return{offsetCacheSize:this.offsetCache.size,dstCacheSize:this.dstCache.size,maxCacheSize:this.maxCacheSize,cacheHits:this.cacheHits,cacheMisses:this.cacheMisses,hitRate:`${e}%`}}_manageCacheSize(){if(this.offsetCache.size>this.maxCacheSize){const e=Math.floor(this.offsetCache.size/2),t=Array.from(this.offsetCache.keys());for(let s=0;s<e;s++)this.offsetCache.delete(t[s])}if(this.dstCache.size>this.maxCacheSize/2){const e=Math.floor(this.dstCache.size/2),t=Array.from(this.dstCache.keys());for(let s=0;s<e;s++)this.dstCache.delete(t[s])}}}class s{static normalize(e){const t={...e};!t.start||t.start instanceof Date||(t.start=new Date(t.start)),!t.end||t.end instanceof Date||(t.end=new Date(t.end)),t.end||(t.end=t.start?new Date(t.start):null),t.allDay&&t.start&&(t.start.setHours(0,0,0,0),t.end&&t.end.setHours(23,59,59,999)),t.id=String(t.id||"").trim(),t.title=String(t.title||"").trim(),t.description=String(t.description||"").trim(),t.location=String(t.location||"").trim(),t.attendees=Array.isArray(t.attendees)?t.attendees:[],t.reminders=Array.isArray(t.reminders)?t.reminders:[],t.categories=Array.isArray(t.categories)?t.categories:[],t.attachments=Array.isArray(t.attachments)?t.attachments:[];["confirmed","tentative","cancelled"].includes(t.status)||(t.status="confirmed");return["public","private","confidential"].includes(t.visibility)||(t.visibility="public"),t.color&&!t.backgroundColor&&(t.backgroundColor=t.color),t.color&&!t.borderColor&&(t.borderColor=t.color),t}static validate(e){if(!e.id)throw new Error("Event must have an id");if(!e.title)throw new Error("Event must have a title");if(!e.start)throw new Error("Event must have a start date");if(!(e.start instanceof Date)||isNaN(e.start.getTime()))throw new Error("Invalid start date");if(e.end&&(!(e.end instanceof Date)||isNaN(e.end.getTime())))throw new Error("Invalid end date");if(e.end&&e.start&&e.end<e.start)throw new Error("Event end time cannot be before start time");if(e.recurring&&!e.recurrenceRule)throw new Error("Recurring events must have a recurrence rule");if(e.attendees&&e.attendees.length>0&&e.attendees.forEach((e,t)=>{if(!e.email||!e.name)throw new Error(`Attendee at index ${t} must have email and name`);if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email))throw new Error(`Invalid email for attendee: ${e.email}`)}),e.reminders&&e.reminders.length>0&&e.reminders.forEach((e,t)=>{if(!e.method||null==e.minutesBefore)throw new Error(`Reminder at index ${t} must have method and minutesBefore`);if(e.minutesBefore<0)throw new Error("Reminder minutesBefore must be non-negative")}),e.timeZone)try{new Intl.DateTimeFormat("en-US",{timeZone:e.timeZone})}catch(t){throw new Error(`Invalid timezone: ${e.timeZone}`)}}constructor({id:e,title:i,start:a,end:n,allDay:r=!1,description:o="",location:c="",color:h=null,backgroundColor:l=null,borderColor:d=null,textColor:u=null,recurring:m=!1,recurrenceRule:f=null,timeZone:g=null,endTimeZone:y=null,status:p="confirmed",visibility:v="public",organizer:w=null,attendees:D=[],reminders:b=[],categories:T=[],attachments:S=[],conferenceData:C=null,metadata:A={}}){const M=s.normalize({id:e,title:i,start:a,end:n,allDay:r,description:o,location:c,color:h,backgroundColor:l,borderColor:d,textColor:u,recurring:m,recurrenceRule:f,timeZone:g,endTimeZone:y,status:p,visibility:v,organizer:w,attendees:D,reminders:b,categories:T,attachments:S,conferenceData:C,metadata:A});s.validate(M),this.id=M.id,this.title=M.title,this._timezoneManager=new t,this.timeZone=M.timeZone||this._timezoneManager.getSystemTimezone(),this.endTimeZone=M.endTimeZone||this.timeZone,this.start=M.start,this.end=M.end,this.startUTC=this._timezoneManager.toUTC(this.start,this.timeZone),this.endUTC=this._timezoneManager.toUTC(this.end,this.endTimeZone),this.allDay=M.allDay,this.description=M.description,this.location=M.location,this.color=M.color,this.backgroundColor=M.backgroundColor,this.borderColor=M.borderColor,this.textColor=M.textColor,this.recurring=M.recurring,this.recurrenceRule=M.recurrenceRule,this._originalTimeZone=M.timeZone||null,this.status=M.status,this.visibility=M.visibility,this.organizer=M.organizer,this.attendees=[...M.attendees],this.reminders=[...M.reminders],this.categories=[...M.categories],this.attachments=[...M.attachments],this.conferenceData=M.conferenceData,this.metadata={...M.metadata},this._cache={},this._validateAttendees(),this._validateReminders()}get duration(){return this._cache.duration||(this._cache.duration=this.endUTC.getTime()-this.startUTC.getTime()),this._cache.duration}getStartInTimezone(e){return e===this.timeZone?new Date(this.start):this._timezoneManager.fromUTC(this.startUTC,e)}getEndInTimezone(e){return e===this.endTimeZone?new Date(this.end):this._timezoneManager.fromUTC(this.endUTC,e)}updateTimes(e,t,s){if(s||this.timeZone,this.start=e instanceof Date?e:new Date(e),this.end=t instanceof Date?t:new Date(t),s&&(this.timeZone=s,this.endTimeZone=s),this.startUTC=this._timezoneManager.toUTC(this.start,this.timeZone),this.endUTC=this._timezoneManager.toUTC(this.end,this.endTimeZone),this._cache={},this.endUTC<this.startUTC)throw new Error("Event end time cannot be before start time")}get durationMinutes(){return Math.floor(this.duration/6e4)}get durationHours(){return this.duration/36e5}get isMultiDay(){if(!this._cache.hasOwnProperty("isMultiDay")){const e=this.start.toDateString(),t=this.end.toDateString();this._cache.isMultiDay=e!==t}return this._cache.isMultiDay}isRecurring(){return this.recurring&&null!==this.recurrenceRule}occursOn(e){e instanceof Date||(e=new Date(e));const t=e.toDateString(),s=this.start.toDateString(),i=this.end.toDateString();if(this.allDay)return e>=new Date(s)&&e<=new Date(i);if(this.isMultiDay){const e=new Date(t),s=new Date(t);return s.setHours(23,59,59,999),this.start<=s&&this.end>=e}return s===t}overlaps(e){if(e instanceof s)return!(this.end<=e.start||this.start>=e.end);if(e&&e.start&&e.end)return!(this.end<=e.start||this.start>=e.end);throw new Error("Parameter must be an Event instance or have start/end properties")}contains(e){return e instanceof Date||(e=new Date(e)),e>=this.start&&e<=this.end}clone(e={}){return new s({id:this.id,title:this.title,start:new Date(this.start),end:new Date(this.end),allDay:this.allDay,description:this.description,location:this.location,color:this.color,backgroundColor:this.backgroundColor,borderColor:this.borderColor,textColor:this.textColor,recurring:this.recurring,recurrenceRule:this.recurrenceRule,timeZone:this.timeZone,status:this.status,visibility:this.visibility,organizer:this.organizer?{...this.organizer}:null,attendees:this.attendees.map(e=>({...e})),reminders:this.reminders.map(e=>({...e})),categories:[...this.categories],attachments:this.attachments.map(e=>({...e})),conferenceData:this.conferenceData?{...this.conferenceData}:null,metadata:{...this.metadata},...e})}toObject(){return{id:this.id,title:this.title,start:this.start.toISOString(),end:this.end.toISOString(),allDay:this.allDay,description:this.description,location:this.location,color:this.color,backgroundColor:this.backgroundColor,borderColor:this.borderColor,textColor:this.textColor,recurring:this.recurring,recurrenceRule:this.recurrenceRule,timeZone:this.timeZone,status:this.status,visibility:this.visibility,organizer:this.organizer,attendees:this.attendees,reminders:this.reminders,categories:this.categories,attachments:this.attachments,conferenceData:this.conferenceData,metadata:{...this.metadata}}}static fromObject(e){return new s(e)}equals(e){return e instanceof s&&(this.id===e.id&&this.title===e.title&&this.start.getTime()===e.start.getTime()&&this.end.getTime()===e.end.getTime()&&this.allDay===e.allDay&&this.description===e.description&&this.location===e.location&&this.recurring===e.recurring&&this.recurrenceRule===e.recurrenceRule&&this.status===e.status)}addAttendee(e){if(!e||!e.email)throw new Error("Attendee must have an email");return!this.hasAttendee(e.email)&&(e.id||(e.id=`attendee_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),e.responseStatus=e.responseStatus||"needs-action",e.role=e.role||"required",this.attendees.push(e),!0)}removeAttendee(e){const t=this.attendees.findIndex(t=>t.email===e||t.id===e);return-1!==t&&(this.attendees.splice(t,1),!0)}updateAttendeeResponse(e,t){const s=this.getAttendee(e);return!!s&&(s.responseStatus=t,s.responseTime=new Date,!0)}getAttendee(e){return this.attendees.find(t=>t.email===e)||null}hasAttendee(e){return this.attendees.some(t=>t.email===e)}getAttendeesByStatus(e){return this.attendees.filter(t=>t.responseStatus===e)}getAttendeeCounts(){return this.attendees.reduce((e,t)=>{const s=t.responseStatus||"needs-action";return e[s]=(e[s]||0)+1,e},{})}addReminder(e){if(!e||"number"!=typeof e.minutesBefore)throw new Error("Reminder must have minutesBefore property");e.id||(e.id=`reminder_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),e.method=e.method||"popup",e.enabled=!1!==e.enabled;return!this.reminders.some(t=>t.method===e.method&&t.minutesBefore===e.minutesBefore)&&(this.reminders.push(e),!0)}removeReminder(e){const t=this.reminders.findIndex(t=>t.id===e);return-1!==t&&(this.reminders.splice(t,1),!0)}getActiveReminders(){return this.reminders.filter(e=>!1!==e.enabled)}getReminderTriggerTimes(){return this.getActiveReminders().map(e=>{const t=new Date(this.start);return t.setMinutes(t.getMinutes()-e.minutesBefore),t})}addCategory(e){if(!e||"string"!=typeof e)throw new Error("Category must be a non-empty string");const t=e.trim().toLowerCase();return!this.hasCategory(t)&&(this.categories.push(t),!0)}removeCategory(e){const t=e.trim().toLowerCase(),s=this.categories.findIndex(e=>e.toLowerCase()===t);return-1!==s&&(this.categories.splice(s,1),!0)}hasCategory(e){const t=e.trim().toLowerCase();return this.categories.some(e=>e.toLowerCase()===t)}hasAnyCategory(e){return e.some(e=>this.hasCategory(e))}hasAllCategories(e){return e.every(e=>this.hasCategory(e))}_validateAttendees(){for(const e of this.attendees){if(!e.email)throw new Error("All attendees must have an email address");if(e.name||(e.name=e.email),!this._isValidEmail(e.email))throw new Error(`Invalid attendee email: ${e.email}`)}}_validateReminders(){for(const e of this.reminders){if("number"!=typeof e.minutesBefore||e.minutesBefore<0)throw new Error("Reminder minutesBefore must be a positive number");if(!["email","popup","sms"].includes(e.method))throw new Error(`Invalid reminder method: ${e.method}`)}}_isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}get isCancelled(){return"cancelled"===this.status}get isTentative(){return"tentative"===this.status}get isConfirmed(){return"confirmed"===this.status}get isPrivate(){return"private"===this.visibility}get isPublic(){return"public"===this.visibility}get hasAttendees(){return this.attendees.length>0}get hasReminders(){return this.reminders.length>0}get isMeeting(){return this.hasAttendees||null!==this.conferenceData}get isVirtual(){return null!==this.conferenceData}}class i{static startOfDay(e){const t=new Date(e);return t.setHours(0,0,0,0),t}static endOfDay(e){const t=new Date(e);return t.setHours(23,59,59,999),t}static startOfWeek(e,t=0){const s=new Date(e),i=s.getDay(),a=(i<t?7:0)+i-t;return s.setTime(s.getTime()-24*a*60*60*1e3),s.setHours(0,0,0,0),s}static endOfWeek(e,t=0){const s=i.startOfWeek(e,t);return s.setTime(s.getTime()+5184e5),s.setHours(23,59,59,999),s}static startOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1,0,0,0,0)}static endOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0,23,59,59,999)}static startOfYear(e){return new Date(e.getFullYear(),0,1,0,0,0,0)}static endOfYear(e){return new Date(e.getFullYear(),11,31,23,59,59,999)}static addDays(e,t){const s=new Date(e);return s.setTime(s.getTime()+24*t*60*60*1e3),s}static addWeeks(e,t){return i.addDays(e,7*t)}static addMonths(e,t){const s=new Date(e),i=s.getDate();return s.setMonth(s.getMonth()+t),s.getDate()!==i&&s.setDate(0),s}static addYears(e,t){const s=new Date(e);return s.setFullYear(s.getFullYear()+t),s}static getUTCDateString(e){return`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}`}static getLocalDateString(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}static isToday(e){const t=new Date;return e.toDateString()===t.toDateString()}static isPast(e){return e<new Date}static isFuture(e){return e>new Date}static isSameDay(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}static isSameWeek(e,t,s=0){const a=i.startOfWeek(e,s),n=i.startOfWeek(t,s);return a.toDateString()===n.toDateString()}static isSameMonth(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()}static isSameYear(e,t){return e.getFullYear()===t.getFullYear()}static differenceInDays(e,t){const s=e.getTime()-t.getTime();return Math.floor(s/864e5)}static differenceInWeeks(e,t){return Math.floor(i.differenceInDays(e,t)/7)}static differenceInMonths(e,t){return 12*(e.getFullYear()-t.getFullYear())+(e.getMonth()-t.getMonth())}static getWeekNumber(e){const t=new Date(e.getFullYear(),0,1),s=(e-t)/864e5;return Math.ceil((s+t.getDay()+1)/7)}static getDayOfWeek(e,t=0){return(e.getDay()-t+7)%7}static getDaysInMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()}static format(e,t="en-US",s={}){return new Intl.DateTimeFormat(t,s).format(e)}static getMonthName(e,t="en-US",s="long"){return i.format(e,t,{month:s})}static getDayName(e,t="en-US",s="long"){return i.format(e,t,{weekday:s})}static formatTime(e,t="en-US",s=!1){return i.format(e,t,{hour:"numeric",minute:"2-digit",hour12:!s})}static parseTime(e){const[t,s]=e.split(":").map(Number);return{hours:t,minutes:s}}static setTime(e,t){const s=new Date(e),{hours:a,minutes:n}=i.parseTime(t);return s.setHours(a,n,0,0),s}static isLeapYear(e){return e%4==0&&e%100!=0||e%400==0}static getDateRange(e,t){const s=[],i=new Date(e),a=t.getTime();for(;i.getTime()<=a;)s.push(new Date(i)),i.setTime(i.getTime()+864e5);return s}static clone(e){return new Date(e)}static isValidDate(e){return e instanceof Date&&!isNaN(e.getTime())}static toTimeZone(e,t){const s=new Intl.DateTimeFormat("en-US",{timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(e),i={};return s.forEach(e=>{"literal"!==e.type&&(i[e.type]=e.value)}),new Date(`${i.year}-${i.month}-${i.day}T${i.hour}:${i.minute}:${i.second}`)}static getTimezoneOffset(e,t){const s=new Date(e.toLocaleString("en-US",{timeZone:"UTC"})),i=new Date(e.toLocaleString("en-US",{timeZone:t}));return(s.getTime()-i.getTime())/6e4}static isDST(e,t){const s=new Date(e.getFullYear(),0,1),a=new Date(e.getFullYear(),6,1),n=i.getTimezoneOffset(s,t),r=i.getTimezoneOffset(a,t),o=i.getTimezoneOffset(e,t);return Math.max(n,r)===o}static addHoursWithDST(e,t,s){const a=new Date(e),n=i.getTimezoneOffset(e,s);a.setTime(a.getTime()+60*t*60*1e3);const r=i.getTimezoneOffset(a,s);if(n!==r){const e=6e4*(r-n);a.setTime(a.getTime()+e)}return a}static createInTimeZone(e,t,s,a=0,n=0,r=0,o){const c=`${e}-${String(t+1).padStart(2,"0")}-${String(s).padStart(2,"0")}`,h=`${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}:${String(r).padStart(2,"0")}`,l=new Date(`${c}T${h}`),d=i.getTimezoneOffset(l,o),u=l.getTime()+6e4*d;return new Date(u)}}class a{static parse(e){if("object"==typeof e)return this.validateRule(e);const t={freq:null,interval:1,count:null,until:null,byDay:[],byWeekNo:[],byMonth:[],byMonthDay:[],byYearDay:[],bySetPos:[],byHour:[],byMinute:[],bySecond:[],wkst:"MO",exceptions:[],tzid:null},s=e.toUpperCase().split(";");for(const e of s){const[s,i]=e.split("=");switch(s){case"FREQ":t.freq=this.parseFrequency(i);break;case"INTERVAL":t.interval=parseInt(i,10),t.interval<1&&(t.interval=1);break;case"COUNT":t.count=parseInt(i,10);break;case"UNTIL":t.until=this.parseDateTime(i);break;case"BYDAY":t.byDay=this.parseByDay(i);break;case"BYWEEKNO":t.byWeekNo=this.parseIntList(i);break;case"BYMONTH":t.byMonth=this.parseIntList(i);break;case"BYMONTHDAY":t.byMonthDay=this.parseIntList(i);break;case"BYYEARDAY":t.byYearDay=this.parseIntList(i);break;case"BYSETPOS":t.bySetPos=this.parseIntList(i);break;case"BYHOUR":t.byHour=this.parseIntList(i);break;case"BYMINUTE":t.byMinute=this.parseIntList(i);break;case"BYSECOND":t.bySecond=this.parseIntList(i);break;case"WKST":t.wkst=i;break;case"EXDATE":t.exceptions=this.parseExceptionDates(i);break;case"TZID":t.tzid=i}}return this.validateRule(t)}static parseFrequency(e){return["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY"].includes(e)?e:"DAILY"}static parseByDay(e){const t=e.split(","),s=["SU","MO","TU","WE","TH","FR","SA"],i=[];for(const e of t){const t=e.match(/^([+-]?\d*)([A-Z]{2})$/);if(t){const[e,a,n]=t;s.includes(n)&&i.push({weekday:n,nth:a?parseInt(a,10):null})}}return i}static parseIntList(e){return e.split(",").map(e=>parseInt(e.trim(),10)).filter(e=>!isNaN(e))}static parseDateTime(e){if(8===e.length){const t=parseInt(e.substr(0,4),10),s=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10);return new Date(t,s,i)}if(15===e.length&&"T"===e[8]){const t=parseInt(e.substr(0,4),10),s=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10),a=parseInt(e.substr(9,2),10),n=parseInt(e.substr(11,2),10),r=parseInt(e.substr(13,2),10);return new Date(t,s,i,a,n,r)}if(16===e.length&&"T"===e[8]&&"Z"===e[15]){const t=parseInt(e.substr(0,4),10),s=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10),a=parseInt(e.substr(9,2),10),n=parseInt(e.substr(11,2),10),r=parseInt(e.substr(13,2),10);return new Date(Date.UTC(t,s,i,a,n,r))}return new Date(e)}static parseExceptionDates(e){return e.split(",").map(e=>this.parseDateTime(e.trim()))}static validateRule(e){if(e.freq||(e.freq="DAILY"),e.count&&e.until)throw new Error("RRULE cannot have both COUNT and UNTIL");e.interval<1&&(e.interval=1);const t=(e,t,s)=>e.filter(e=>e>=t&&e<=s);return e.byMonth=t(e.byMonth||[],1,12),e.byMonthDay=t(e.byMonthDay||[],-31,31).filter(e=>0!==e),e.byYearDay=t(e.byYearDay||[],-366,366).filter(e=>0!==e),e.byWeekNo=t(e.byWeekNo||[],-53,53).filter(e=>0!==e),e.byHour=t(e.byHour||[],0,23),e.byMinute=t(e.byMinute||[],0,59),e.bySecond=t(e.bySecond||[],0,59),e}static buildRRule(e){const t=[];if(t.push(`FREQ=${e.freq}`),e.interval&&e.interval>1&&t.push(`INTERVAL=${e.interval}`),e.count?t.push(`COUNT=${e.count}`):e.until&&t.push(`UNTIL=${this.formatDateTime(e.until)}`),e.byDay&&e.byDay.length>0){const s=e.byDay.map(e=>e.nth?`${e.nth}${e.weekday}`:e.weekday).join(",");t.push(`BYDAY=${s}`)}return e.byMonth&&e.byMonth.length>0&&t.push(`BYMONTH=${e.byMonth.join(",")}`),e.byMonthDay&&e.byMonthDay.length>0&&t.push(`BYMONTHDAY=${e.byMonthDay.join(",")}`),e.byYearDay&&e.byYearDay.length>0&&t.push(`BYYEARDAY=${e.byYearDay.join(",")}`),e.byWeekNo&&e.byWeekNo.length>0&&t.push(`BYWEEKNO=${e.byWeekNo.join(",")}`),e.bySetPos&&e.bySetPos.length>0&&t.push(`BYSETPOS=${e.bySetPos.join(",")}`),e.byHour&&e.byHour.length>0&&t.push(`BYHOUR=${e.byHour.join(",")}`),e.byMinute&&e.byMinute.length>0&&t.push(`BYMINUTE=${e.byMinute.join(",")}`),e.bySecond&&e.bySecond.length>0&&t.push(`BYSECOND=${e.bySecond.join(",")}`),e.wkst&&"MO"!==e.wkst&&t.push(`WKST=${e.wkst}`),t.join(";")}static formatDateTime(e){return`${e.getUTCFullYear()}${String(e.getUTCMonth()+1).padStart(2,"0")}${String(e.getUTCDate()).padStart(2,"0")}T${String(e.getUTCHours()).padStart(2,"0")}${String(e.getUTCMinutes()).padStart(2,"0")}${String(e.getUTCSeconds()).padStart(2,"0")}Z`}static getDescription(e){const t={SU:"Sunday",MO:"Monday",TU:"Tuesday",WE:"Wednesday",TH:"Thursday",FR:"Friday",SA:"Saturday"},s={1:"first",2:"second",3:"third",4:"fourth",5:"fifth","-1":"last","-2":"second to last"};let i="Every";if(e.interval>1&&(i+=` ${e.interval}`),i+=` ${{SECONDLY:"second",MINUTELY:"minute",HOURLY:"hour",DAILY:"day",WEEKLY:"week",MONTHLY:"month",YEARLY:"year"}[e.freq]}`,e.interval>1&&(i+="s"),e.byDay&&e.byDay.length>0)if("WEEKLY"===e.freq){i+=` on ${e.byDay.map(e=>t[e.weekday]).join(", ")}`}else if("MONTHLY"===e.freq||"YEARLY"===e.freq){i+=` on ${e.byDay.map(e=>e.nth?`the ${s[e.nth]||e.nth} ${t[e.weekday]}`:t[e.weekday]).join(", ")}`}if(e.byMonthDay&&e.byMonthDay.length>0){i+=` on ${e.byMonthDay.map(e=>e<0?`${Math.abs(e)} day(s) from the end`:`day ${e}`).join(", ")}`}if(e.byMonth&&e.byMonth.length>0){const t=["January","February","March","April","May","June","July","August","September","October","November","December"];i+=` in ${e.byMonth.map(e=>t[e-1]).join(", ")}`}return e.count?i+=`, ${e.count} time${e.count>1?"s":""}`:e.until&&(i+=`, until ${e.until.toLocaleDateString()}`),i}}class n{static expandEvent(e,s,i,a=365,n=null){if(!e.recurring||!e.recurrenceRule)return[{start:e.start,end:e.end,timezone:e.timeZone}];const r=this.parseRule(e.recurrenceRule),o=[],c=e.end-e.start,h=n||e.timeZone||"UTC",l=new t;let d=new Date(e.start),u=0;r.until&&r.until<i&&(i=r.until);let m=l.getTimezoneOffset(d,h);for(;d<=i&&u<a;){if(d>=s){const t=new Date(d),s=new Date(d.getTime()+c),i=l.getTimezoneOffset(t,h);if(i!==m){const e=m-i;t.setMinutes(t.getMinutes()+e),s.setMinutes(s.getMinutes()+e)}m=i,this.isException(t,r,e.id)||o.push({start:t,end:s,recurringEventId:e.id,timezone:h,originalStart:e.start})}if(d=this.getNextOccurrence(d,r,h),u++,r.count&&u>=r.count)break}return o}static parseRule(e){return a.parse(e)}static getNextOccurrence(e,t,s="UTC"){const i=new Date(e);switch(t.freq){case"DAILY":i.setDate(i.getDate()+t.interval);break;case"WEEKLY":if(t.byDay&&t.byDay.length>0)for(i.setDate(i.getDate()+1);!this.matchesByDay(i,t.byDay);)i.setDate(i.getDate()+1);else i.setDate(i.getDate()+7*t.interval);break;case"MONTHLY":if(t.byMonthDay&&t.byMonthDay.length>0){const e=i.getMonth();i.setMonth(e+t.interval),i.setDate(t.byMonthDay[0])}else t.byDay&&t.byDay.length>0?(i.setMonth(i.getMonth()+t.interval),this.setToWeekdayOfMonth(i,t.byDay[0],t.bySetPos[0]||1)):i.setMonth(i.getMonth()+t.interval);break;case"YEARLY":t.byMonth&&t.byMonth.length>0?(i.setFullYear(i.getFullYear()+t.interval),i.setMonth(t.byMonth[0]-1)):i.setFullYear(i.getFullYear()+t.interval);break;default:i.setTime(i.getTime()+864e5)}return i}static matchesByDay(e,t){const s={SU:0,MO:1,TU:2,WE:3,TH:4,FR:5,SA:6},i=e.getDay();return t.some(e=>{const t=e.match(/^(-?\d+)?([A-Z]{2})$/);if(t){const e=t[2];return s[e]===i}return!1})}static setToWeekdayOfMonth(e,t,s=1){const i=t.match(/^(-?\d+)?([A-Z]{2})$/),a={SU:0,MO:1,TU:2,WE:3,TH:4,FR:5,SA:6}[i?i[2]:t];for(e.setDate(1);e.getDay()!==a;)e.setDate(e.getDate()+1);if(s>1)e.setDate(e.getDate()+7*(s-1));else if(-1===s){const t=new Date(e);for(t.setMonth(t.getMonth()+1),t.setDate(0);t.getDay()!==a;)t.setDate(t.getDate()-1);e.setTime(t.getTime())}}static isException(e,t,s=null){if(!t.exceptions||0===t.exceptions.length)return!1;const i=e.toDateString(),a=e.getTime();return t.exceptions.some(e=>{if("object"==typeof e&&e.date){const t=e.date instanceof Date?e.date:new Date(e.date);return e.matchTime?Math.abs(t.getTime()-a)<1e3:t.toDateString()===i}return(e instanceof Date?e:new Date(e)).toDateString()===i})}static addExceptions(e,t,s={}){e.exceptions||(e.exceptions=[]);return(Array.isArray(t)?t:[t]).forEach(t=>{s.reason||s.matchTime?e.exceptions.push({date:t,reason:s.reason,matchTime:s.matchTime||!1}):e.exceptions.push(t)}),e}static parseDate(e){if(8===e.length){const t=parseInt(e.substr(0,4),10),s=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10);return new Date(t,s,i)}if(15===e.length||16===e.length){const t=parseInt(e.substr(0,4),10),s=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10),a=parseInt(e.substr(9,2),10),n=parseInt(e.substr(11,2),10),r=parseInt(e.substr(13,2),10);return e.endsWith("Z")?new Date(Date.UTC(t,s,i,a,n,r)):new Date(t,s,i,a,n,r)}return new Date(e)}static getDescription(e){"string"==typeof e&&(e=this.parseRule(e));let t="";const s=e.interval||1;switch(e.freq){case"DAILY":t=1===s?"Daily":`Every ${s} days`;break;case"WEEKLY":if(t=1===s?"Weekly":`Every ${s} weeks`,e.byDay&&e.byDay.length>0){t+=` on ${e.byDay.map(e=>this.getDayName(e)).join(", ")}`}break;case"MONTHLY":t=1===s?"Monthly":`Every ${s} months`,e.byMonthDay&&e.byMonthDay.length>0&&(t+=` on day ${e.byMonthDay.join(", ")}`);break;case"YEARLY":t=1===s?"Yearly":`Every ${s} years`}return e.count?t+=`, ${e.count} times`:e.until&&(t+=`, until ${e.until.toLocaleDateString()}`),t}static getDayName(e){const t=e.match(/^(-?\d+)?([A-Z]{2})$/),s=t?t[2]:e,i=t&&t[1]?parseInt(t[1],10):null;let a={SU:"Sunday",MO:"Monday",TU:"Tuesday",WE:"Wednesday",TH:"Thursday",FR:"Friday",SA:"Saturday"}[s]||e;if(i){a=`${-1===i?"Last":["","1st","2nd","3rd","4th","5th"][i]||`${i}th`} ${a}`}return a}}class r{constructor(e=100){this.capacity=e,this.cache=new Map,this.hits=0,this.misses=0,this.evictions=0}get(e){if(!this.cache.has(e))return void this.misses++;const t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),this.hits++,t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.capacity){const e=this.cache.keys().next().value;this.cache.delete(e),this.evictions++}this.cache.set(e,t)}has(e){return this.cache.has(e)}delete(e){return this.cache.delete(e)}clear(){this.cache.clear(),this.hits=0,this.misses=0,this.evictions=0}getStats(){const e=this.hits+this.misses>0?(this.hits/(this.hits+this.misses)*100).toFixed(2):0;return{size:this.cache.size,capacity:this.capacity,hits:this.hits,misses:this.misses,evictions:this.evictions,hitRate:`${e}%`}}keys(){return Array.from(this.cache.keys())}get size(){return this.cache.size}}class o{constructor(e={}){this.config={checkInterval:3e4,memoryThreshold:.8,criticalThreshold:.95,minCacheSize:10,maxCacheSize:1e4,adaptiveScaling:!0,...e},this.caches=new Map,this.stats={adjustments:0,emergencyClears:0,lastMemoryUsage:0,lastCheckTime:null,cacheResizes:[]},this.monitoringInterval=null,this.config.adaptiveScaling&&this.startMonitoring()}registerCache(e,t,s={}){this.caches.set(e,{cache:t,priority:s.priority||1,currentCapacity:s.initialCapacity||100,minCapacity:s.minCapacity||this.config.minCacheSize,maxCapacity:s.maxCapacity||this.config.maxCacheSize,scaleFactor:s.scaleFactor||.5,lastAccess:Date.now()})}unregisterCache(e){this.caches.delete(e)}startMonitoring(){this.monitoringInterval||(this.monitoringInterval=setInterval(()=>{this.checkMemoryPressure()},this.config.checkInterval),this.checkMemoryPressure())}stopMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null)}async checkMemoryPressure(){const e=await this.getMemoryUsage();this.stats.lastMemoryUsage=e,this.stats.lastCheckTime=new Date,e>this.config.criticalThreshold?this.emergencyClear():e>this.config.memoryThreshold?this.reduceCacheSizes(e):e<this.config.memoryThreshold-.2&&this.increaseCacheSizes()}async getMemoryUsage(){if("undefined"!=typeof performance&&performance.memory){const e=performance.memory;if(e.jsHeapSizeLimit&&e.usedJSHeapSize)return e.usedJSHeapSize/e.jsHeapSizeLimit}if("undefined"!=typeof process&&process.memoryUsage){const e=process.memoryUsage();return e.heapUsed/e.heapTotal}return this.estimateMemoryUsage()}estimateMemoryUsage(){let e=0,t=0;for(const[s,i]of this.caches)void 0!==i.cache.size&&(e+=i.cache.size,t+=i.maxCapacity);return t>0?e/t:.5}reduceCacheSizes(e){const t=(e-this.config.memoryThreshold)/(this.config.criticalThreshold-this.config.memoryThreshold),s=Array.from(this.caches.entries()).sort((e,t)=>e[1].priority-t[1].priority);for(const[e,i]of s){const s=Math.floor(i.currentCapacity*i.scaleFactor*t),a=Math.max(i.minCapacity,i.currentCapacity-s);a<i.currentCapacity&&this.resizeCache(e,i,a)}this.stats.adjustments++}increaseCacheSizes(){for(const[e,t]of this.caches){if(Date.now()-t.lastAccess<6e4){const s=Math.floor(.2*t.currentCapacity),i=Math.min(t.maxCapacity,t.currentCapacity+s);i>t.currentCapacity&&this.resizeCache(e,t,i)}}}resizeCache(e,t,s){const i=t.currentCapacity;t.currentCapacity=s,void 0!==t.cache.capacity&&(t.cache.capacity=s),t.cache.size>s&&this.evictExcessItems(t.cache,s),this.stats.cacheResizes.push({cache:e,timestamp:new Date,oldCapacity:i,newCapacity:s,reason:s<i?"pressure":"available"}),this.stats.cacheResizes.length>100&&this.stats.cacheResizes.shift()}evictExcessItems(e,t){if(e.size<=t)return;const s=e.size-t;if(e.keys){const t=Array.from(e.keys());for(let i=0;i<s;i++)e.delete(t[i])}else e.clear&&e.clear()}emergencyClear(){for(const[e,t]of this.caches)t.cache.clear&&t.cache.clear(),t.currentCapacity=t.minCapacity;this.stats.emergencyClears++,console.warn("AdaptiveMemoryManager: Emergency cache clear triggered")}touchCache(e){const t=this.caches.get(e);t&&(t.lastAccess=Date.now())}getStats(){const e={};for(const[t,s]of this.caches)e[t]={size:s.cache.size||0,capacity:s.currentCapacity,priority:s.priority,lastAccess:new Date(s.lastAccess)};return{...this.stats,memoryUsagePercent:`${(100*this.stats.lastMemoryUsage).toFixed(2)}%`,totalCaches:this.caches.size,cacheStats:e,monitoring:null!==this.monitoringInterval}}async checkNow(){await this.checkMemoryPressure()}setThresholds(e){void 0!==e.memoryThreshold&&(this.config.memoryThreshold=Math.max(.5,Math.min(.95,e.memoryThreshold))),void 0!==e.criticalThreshold&&(this.config.criticalThreshold=Math.max(this.config.memoryThreshold+.05,Math.min(1,e.criticalThreshold)))}destroy(){this.stopMonitoring(),this.caches.clear()}}class c{constructor(e={}){this.config={enableCache:!0,cacheCapacity:500,maxIndexDays:365,batchSize:100,enableMetrics:!0,cleanupInterval:36e5,maxIndexAge:2592e6,enableAdaptiveMemory:!0,...e},this.eventCache=new r(this.config.cacheCapacity),this.queryCache=new r(Math.floor(this.config.cacheCapacity/2)),this.dateRangeCache=new r(Math.floor(this.config.cacheCapacity/4)),this.config.enableAdaptiveMemory&&(this.memoryManager=new o({checkInterval:3e4,memoryThreshold:.75,criticalThreshold:.9}),this.memoryManager.registerCache("events",this.eventCache,{priority:3,initialCapacity:this.config.cacheCapacity,minCapacity:50,maxCapacity:2e3}),this.memoryManager.registerCache("queries",this.queryCache,{priority:2,initialCapacity:Math.floor(this.config.cacheCapacity/2),minCapacity:25,maxCapacity:1e3}),this.memoryManager.registerCache("dateRanges",this.dateRangeCache,{priority:1,initialCapacity:Math.floor(this.config.cacheCapacity/4),minCapacity:10,maxCapacity:500})),this.lazyIndexes=new Map,this.pendingIndexes=new Map,this.batchQueue=[],this.batchTimer=null,this.batchCallbacks=[],this.metrics={operations:{},averageTimes:{},slowQueries:[]},this.cleanupTimer=null,this.config.cleanupInterval>0&&this.startCleanupTimer()}measure(e,t){if(!this.config.enableMetrics)return t();const s=performance.now();try{const i=t(),a=performance.now()-s;return this.recordMetric(e,a),i}catch(t){const i=performance.now()-s;throw this.recordMetric(e,i,!0),t}}async measureAsync(e,t){if(!this.config.enableMetrics)return await t();const s=performance.now();try{const i=await t(),a=performance.now()-s;return this.recordMetric(e,a),i}catch(t){const i=performance.now()-s;throw this.recordMetric(e,i,!0),t}}recordMetric(e,t,s=!1){this.metrics.operations[e]||(this.metrics.operations[e]={count:0,totalTime:0,errors:0,min:1/0,max:0});const i=this.metrics.operations[e];i.count++,i.totalTime+=t,i.min=Math.min(i.min,t),i.max=Math.max(i.max,t),s&&i.errors++,this.metrics.averageTimes[e]=i.totalTime/i.count,t>100&&(this.metrics.slowQueries.push({operation:e,duration:t,timestamp:new Date,isError:s}),this.metrics.slowQueries.length>100&&this.metrics.slowQueries.shift())}getMetrics(){const e={cacheStats:{event:this.eventCache.getStats(),query:this.queryCache.getStats(),dateRange:this.dateRangeCache.getStats()},operations:{},slowestOperations:[],recentSlowQueries:this.metrics.slowQueries.slice(-10),memoryManagement:this.memoryManager?this.memoryManager.getStats():null};for(const[t,s]of Object.entries(this.metrics.operations))e.operations[t]={count:s.count,avgTime:`${(s.totalTime/s.count).toFixed(2)}ms`,minTime:`${s.min.toFixed(2)}ms`,maxTime:`${s.max.toFixed(2)}ms`,totalTime:`${s.totalTime.toFixed(2)}ms`,errors:s.errors,errorRate:`${(s.errors/s.count*100).toFixed(2)}%`};return e.slowestOperations=Object.entries(this.metrics.averageTimes).sort((e,t)=>t[1]-e[1]).slice(0,5).map(([e,t])=>({operation:e,avgTime:`${t.toFixed(2)}ms`})),e}shouldUseLazyIndexing(e){return Math.ceil((e.end-e.start)/864e5)>this.config.maxIndexDays}createLazyIndexMarkers(e){const t={eventId:e.id,start:e.start,end:e.end,indexed:new Set,pending:!1},s=new Date(e.start.getFullYear(),e.start.getMonth(),1),i=new Date(e.end.getFullYear(),e.end.getMonth(),1);return t.indexed.add(this.getMonthKey(s)),this.getMonthKey(s)!==this.getMonthKey(i)&&t.indexed.add(this.getMonthKey(i)),this.lazyIndexes.set(e.id,t),t}async expandLazyIndex(e,t,s){const i=this.lazyIndexes.get(e);if(!i)return new Set;if(i.pending)return this.pendingIndexes.get(e);i.pending=!0;const a=new Promise(a=>{setTimeout(()=>{const n=new Set,r=new Date(t);for(;r<=s;){const e=r.toDateString();i.indexed.has(e)||(n.add(e),i.indexed.add(e)),r.setDate(r.getDate()+1)}i.pending=!1,this.pendingIndexes.delete(e),a(n)},0)});return this.pendingIndexes.set(e,a),a}getMonthKey(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`}cache(e,t,s="event"){if(!this.config.enableCache)return;let i,a;switch(s){case"event":i=this.eventCache,a="events";break;case"query":i=this.queryCache,a="queries";break;case"dateRange":i=this.dateRangeCache,a="dateRanges";break;default:return}i.put(e,t),this.memoryManager&&this.memoryManager.touchCache(a)}getFromCache(e,t="event"){if(!this.config.enableCache)return;let s,i;switch(t){case"event":s=this.eventCache.get(e),i="events";break;case"query":s=this.queryCache.get(e),i="queries";break;case"dateRange":s=this.dateRangeCache.get(e),i="dateRanges";break;default:return}return void 0!==s&&this.memoryManager&&this.memoryManager.touchCache(i),s}invalidateEventCaches(e){this.eventCache.delete(e),this.queryCache.clear(),this.dateRangeCache.clear()}batch(e){return new Promise((t,s)=>{this.batchQueue.push(e),this.batchCallbacks.push({resolve:t,reject:s}),this.batchQueue.length>=this.config.batchSize?this.processBatch():this.batchTimer||(this.batchTimer=setTimeout(()=>this.processBatch(),10))})}processBatch(){if(this.batchTimer&&(clearTimeout(this.batchTimer),this.batchTimer=null),0===this.batchQueue.length)return;const e=this.batchQueue.splice(0),t=this.batchCallbacks.splice(0),s=[],i=[];e.forEach((e,t)=>{try{s[t]=e()}catch(e){i[t]=e}}),t.forEach((e,t)=>{i[t]?e.reject(i[t]):e.resolve(s[t])})}startCleanupTimer(){this.cleanupTimer=setInterval(()=>{this.cleanupOldIndexes()},this.config.cleanupInterval)}cleanupOldIndexes(){const e=Date.now(),t=this.config.maxIndexAge;for(const[s,i]of this.lazyIndexes)i.end.getTime()<e-t&&this.lazyIndexes.delete(s);this.metrics.slowQueries.length>100&&(this.metrics.slowQueries=this.metrics.slowQueries.slice(-100))}optimizeQuery(e,t){const s=this.getFromCache(e,"query");if(void 0!==s)return s;const i=this.measure(`query:${e}`,t);return this.cache(e,i,"query"),i}destroy(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null),this.batchTimer&&(clearTimeout(this.batchTimer),this.batchTimer=null),this.eventCache.clear(),this.queryCache.clear(),this.dateRangeCache.clear(),this.lazyIndexes.clear(),this.pendingIndexes.clear()}}class h{constructor(e){this.eventStore=e,this.conflictIdCounter=0}checkConflicts(e,t={}){const s={checkAttendees:!0,checkResources:!0,checkLocation:!0,ignoreAllDay:!1,excludeEventIds:[],includeStatuses:["confirmed","tentative"],bufferMinutes:0,...t};if(!e.start||!e.end)throw new Error("Event must have start and end dates");const i=[],a=new Set,n=new Set,r=new Date(e.start.getTime()-6e4*s.bufferMinutes),o=new Date(e.end.getTime()+6e4*s.bufferMinutes),c=this.eventStore.getEventsInRange(r,o,!1).filter(t=>t.id!==e.id&&(!s.excludeEventIds.includes(t.id)&&(!!s.includeStatuses.includes(t.status)&&((!s.ignoreAllDay||!t.allDay&&!e.allDay)&&"cancelled"!==t.status))));for(const t of c){const r=this._detectEventConflicts(e,t,s);r.length>0&&(i.push(...r),a.add(e.id),a.add(t.id),e.attendees&&e.attendees.forEach(e=>n.add(e.email)),t.attendees&&t.attendees.forEach(e=>n.add(e.email)))}return this._buildConflictSummary(i,a,n)}checkEventPairConflicts(e,t,s={}){const i={checkAttendees:!0,checkResources:!0,checkLocation:!0,bufferMinutes:0,...s};return this._detectEventConflicts(e,t,i)}getBusyPeriods(e,t,s,i={}){const a={includeStatuses:["confirmed","tentative"],mergePeriods:!0,...i},n=[];return this.eventStore.getEventsInRange(t,s,!1).filter(t=>!!a.includeStatuses.includes(t.status)&&("cancelled"!==t.status&&(t.attendees&&t.attendees.some(t=>e.includes(t.email))))).forEach(e=>{n.push({start:e.start,end:e.end,eventIds:[e.id]})}),a.mergePeriods&&n.length>1?this._mergeBusyPeriods(n):n.sort((e,t)=>e.start-t.start)}getFreePeriods(e,t,s,i={}){const a={attendeeEmails:[],businessHoursOnly:!1,businessHours:{start:"09:00",end:"17:00"},excludeWeekends:!1,...i},n=[],r=a.attendeeEmails.length>0?this.getBusyPeriods(a.attendeeEmails,e,t):this._getAllBusyPeriods(e,t);let o=new Date(e);for(const e of r){if(o<e.start){(e.start-o)/6e4>=s&&(a.businessHoursOnly&&!this._isWithinBusinessHours(o,e.start,a)||n.push({start:new Date(o),end:new Date(e.start)}))}o=new Date(Math.max(o.getTime(),e.end.getTime()))}if(o<t){(t-o)/6e4>=s&&(a.businessHoursOnly&&!this._isWithinBusinessHours(o,t,a)||n.push({start:new Date(o),end:new Date(t)}))}return n}_detectEventConflicts(e,t,s){const i=[];if(this._checkTimeOverlap(e,t,s.bufferMinutes)){const a=this._createTimeConflict(e,t);if(i.push(a),s.checkAttendees){const s=this._checkAttendeeConflicts(e,t);i.push(...s)}if(s.checkResources){const s=this._checkResourceConflicts(e,t);i.push(...s)}if(s.checkLocation){const s=this._checkLocationConflict(e,t);s&&i.push(s)}}return i}_checkTimeOverlap(e,t,s=0){const i=6e4*s,a=e.start.getTime()-i,n=e.end.getTime()+i,r=t.start.getTime(),o=t.end.getTime();return!(n<=r||o<=a)}_createTimeConflict(e,t){const s=new Date(Math.max(e.start.getTime(),t.start.getTime())),i=new Date(Math.min(e.end.getTime(),t.end.getTime())),a=(i-s)/6e4;let n="low";return a>=60?n="high":a>=30&&(n="medium"),"confirmed"===e.status&&"confirmed"===t.status&&(n="low"===n?"medium":"medium"===n?"high":"critical"),{id:"conflict_"+ ++this.conflictIdCounter,type:"time",severity:n,eventId:e.id,conflictingEventId:t.id,description:`Time overlap: ${e.title} conflicts with ${t.title}`,overlapStart:s,overlapEnd:i,overlapMinutes:a,metadata:{event1Title:e.title,event2Title:t.title,event1Status:e.status,event2Status:t.status}}}_checkAttendeeConflicts(e,t){const s=[];if(!e.attendees||!t.attendees)return s;const i=[];for(const s of e.attendees)for(const e of t.attendees)s.email===e.email&&i.push(s.email);if(i.length>0){let a="medium";i.some(s=>{const i=e.attendees.find(e=>e.email===s),a=t.attendees.find(e=>e.email===s);return"accepted"===i?.responseStatus&&"accepted"===a?.responseStatus})&&(a="critical"),s.push({id:"conflict_"+ ++this.conflictIdCounter,type:"attendee",severity:a,eventId:e.id,conflictingEventId:t.id,description:`Attendee conflict: ${i.length} attendee(s) double-booked`,conflictingAttendees:i,metadata:{attendeeCount:i.length,attendeeEmails:i}})}return s}_checkResourceConflicts(e,t){const s=[],i=e.attendees?.filter(e=>e.resource)||[],a=t.attendees?.filter(e=>e.resource)||[];for(const n of i)for(const i of a)n.email===i.email&&s.push({id:"conflict_"+ ++this.conflictIdCounter,type:"resource",severity:"critical",eventId:e.id,conflictingEventId:t.id,description:`Resource conflict: ${n.name} is double-booked`,conflictingResource:n.email,metadata:{resourceName:n.name,resourceEmail:n.email}});return s}_checkLocationConflict(e,t){if(!e.location||!t.location)return null;return e.location.trim().toLowerCase()===t.location.trim().toLowerCase()?{id:"conflict_"+ ++this.conflictIdCounter,type:"location",severity:"high",eventId:e.id,conflictingEventId:t.id,description:`Location conflict: ${e.location} is double-booked`,metadata:{location:e.location}}:null}_buildConflictSummary(e,t,s){const i={},a={};for(const t of e)i[t.type]=(i[t.type]||0)+1,a[t.severity]=(a[t.severity]||0)+1;return{hasConflicts:e.length>0,totalConflicts:e.length,conflicts:e,conflictsByType:i,conflictsBySeverity:a,affectedEventIds:Array.from(t),affectedAttendees:Array.from(s)}}_mergeBusyPeriods(e){if(e.length<=1)return e;e.sort((e,t)=>e.start-t.start);const t=[e[0]];for(let s=1;s<e.length;s++){const i=e[s],a=t[t.length-1];i.start<=a.end?(a.end=new Date(Math.max(a.end.getTime(),i.end.getTime())),a.eventIds.push(...i.eventIds)):t.push(i)}return t}_getAllBusyPeriods(e,t){return this.eventStore.getEventsInRange(e,t,!1).filter(e=>"cancelled"!==e.status).map(e=>({start:e.start,end:e.end,eventIds:[e.id]})).sort((e,t)=>e.start-t.start)}_isWithinBusinessHours(e,t,s){const i=e.getHours(),a=t.getHours(),n=parseInt(s.businessHours.start.split(":")[0]),r=parseInt(s.businessHours.end.split(":")[0]);return i>=n&&a<=r}}class l{constructor(e={}){this.events=new Map,this.indices={byDate:new Map,byMonth:new Map,recurring:new Set,byCategory:new Map,byStatus:new Map},this.timezoneManager=new t,this.defaultTimezone=e.timezone||this.timezoneManager.getSystemTimezone(),this.optimizer=new c(e.performance),this.conflictDetector=new h(this),this.isBatchMode=!1,this.batchNotifications=[],this.batchBackup=null,this.version=0,this.listeners=new Set}addEvent(e){return this.optimizer.measure("addEvent",()=>{if(e instanceof s||(e=new s(e)),this.events.has(e.id))throw new Error(`Event with id ${e.id} already exists`);return this.events.set(e.id,e),this.optimizer.cache(e.id,e,"event"),this._indexEvent(e),this.isBatchMode?this.batchNotifications.push({type:"add",event:e,version:++this.version}):this._notifyChange({type:"add",event:e,version:++this.version}),e})}updateEvent(e,t){const s=this.events.get(e);if(!s)throw new Error(`Event with id ${e} not found`);this._unindexEvent(s);const i=s.clone(t);return this.events.set(e,i),this._indexEvent(i),this._notifyChange({type:"update",event:i,oldEvent:s,version:++this.version}),i}removeEvent(e){const t=this.events.get(e);return!!t&&(this.events.delete(e),this._unindexEvent(t),this._notifyChange({type:"remove",event:t,version:++this.version}),!0)}getEvent(e){const t=this.optimizer.getFromCache(e,"event");if(t)return t;const s=this.events.get(e)||null;return s&&this.optimizer.cache(e,s,"event"),s}getAllEvents(){return Array.from(this.events.values())}queryEvents(e={}){let t=Array.from(this.events.values());if(e.start||e.end){const s=e.start?new Date(e.start):null,i=e.end?new Date(e.end):null;t=t.filter(e=>!(s&&e.end<s)&&!(i&&e.start>i))}if(e.date){const s=new Date(e.date);t=t.filter(e=>e.occursOn(s))}if(e.month&&e.year){const s=`${e.year}-${String(e.month).padStart(2,"0")}`,i=this.indices.byMonth.get(s)||new Set;t=t.filter(e=>i.has(e.id))}return e.hasOwnProperty("allDay")&&(t=t.filter(t=>t.allDay===e.allDay)),e.hasOwnProperty("recurring")&&(t=t.filter(t=>t.recurring===e.recurring)),e.status&&(t=t.filter(t=>t.status===e.status)),e.categories&&e.categories.length>0&&(t=t.filter(t=>e.matchAllCategories?t.hasAllCategories(e.categories):t.hasAnyCategory(e.categories))),e.hasOwnProperty("hasAttendees")&&(t=t.filter(t=>e.hasAttendees?t.hasAttendees:!t.hasAttendees)),e.organizerEmail&&(t=t.filter(t=>t.organizer&&t.organizer.email===e.organizerEmail)),e.sort&&t.sort((t,s)=>{switch(e.sort){case"start":return t.start-s.start;case"end":return t.end-s.end;case"duration":return t.duration-s.duration;case"title":return t.title.localeCompare(s.title);default:return 0}}),t}getEventsForDate(e,t=null){t=t||this.defaultTimezone,i.getLocalDateString(e);const s=[],a=new Date(e);for(let n=-1;n<=1;n++){const r=new Date(a);r.setDate(r.getDate()+n);const o=i.getLocalDateString(r),c=this.indices.byDate.get(o)||new Set;for(const i of c){const a=this.events.get(i);if(a&&!s.find(e=>e.id===a.id)){const i=a.getStartInTimezone(t),n=a.getEndInTimezone(t),r=new Date(e);r.setHours(0,0,0,0);const o=new Date(e);o.setHours(23,59,59,999),i<=o&&n>=r&&s.push(a)}}}return s.sort((e,s)=>{const i=e.getStartInTimezone(t)-s.getStartInTimezone(t);return 0!==i?i:s.duration-e.duration})}getOverlappingEvents(e,t,s=null){const a=[],n=i.startOfDay(e),r=i.endOfDay(t),o=i.getDateRange(n,r),c=new Set;return o.forEach(i=>{const n=i.toDateString();(this.indices.byDate.get(n)||new Set).forEach(i=>{if(!c.has(i)&&i!==s){c.add(i);const s=this.events.get(i);s&&s.overlaps({start:e,end:t})&&a.push(s)}})}),a.sort((e,t)=>e.start-t.start)}hasConflicts(e,t,s=null){return this.getOverlappingEvents(e,t,s).length>0}getOverlapGroups(e,t=!0){let s=this.getEventsForDate(e);t&&(s=s.filter(e=>!e.allDay));const i=[],a=new Set;return s.forEach(e=>{if(a.has(e.id))return;const t=[e];a.add(e.id);let n=0;for(;n<t.length;){const e=t[n];s.forEach(s=>{!a.has(s.id)&&e.overlaps(s)&&(t.push(s),a.add(s.id))}),n++}i.push(t)}),i}calculateEventPositions(e){const t=new Map;if(0===e.length)return t;e.sort((e,t)=>{const s=e.start-t.start;return 0!==s?s:t.end-t.start-(e.end-e.start)});const s=[];e.forEach(e=>{let i=0;for(;i<s.length;){if(!s[i].some(t=>t.overlaps(e)))break;i++}s[i]||(s[i]=[]),s[i].push(e),t.set(e.id,{column:i,totalColumns:0})});const i=s.length;return t.forEach(e=>{e.totalColumns=i}),t}getEventsInRange(e,t,s=!0,i=null){"string"==typeof s&&(i=s,s=!0),i=i||this.defaultTimezone;const a=this.timezoneManager.toUTC(e,i),n=this.timezoneManager.toUTC(t,i),r=this.queryEvents({start:a,end:n,sort:"start"});if(!s)return r;const o=[];return r.forEach(s=>{if(s.recurring&&s.recurrenceRule){const a=this.expandRecurringEvent(s,e,t,i);o.push(...a)}else o.push(s)}),o.sort((e,t)=>e.getStartInTimezone(i)-t.getStartInTimezone(i))}expandRecurringEvent(e,t,s,i=null){if(!e.recurring||!e.recurrenceRule)return[e];i=i||this.defaultTimezone;const a=e.timeZone||i;return n.expandEvent(e,t,s).map((t,s)=>e.clone({id:`${e.id}_occurrence_${s}`,start:t.start,end:t.end,timeZone:a,metadata:{...e.metadata,recurringEventId:e.id,occurrenceIndex:s}}))}clear(){const e=this.getAllEvents();this.events.clear(),this.indices.byDate.clear(),this.indices.byMonth.clear(),this.indices.recurring.clear(),this._notifyChange({type:"clear",oldEvents:e,version:++this.version})}loadEvents(e){this.clear();for(const t of e)this.addEvent(t)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}_indexEvent(e){if(this.optimizer.shouldUseLazyIndexing(e))return void this._indexEventLazy(e);const t=e.getStartInTimezone(e.timeZone),s=e.getEndInTimezone(e.endTimeZone||e.timeZone),a=i.startOfDay(t),n=i.endOfDay(s);i.getDateRange(a,n).forEach(t=>{const s=i.getLocalDateString(t);this.indices.byDate.has(s)||this.indices.byDate.set(s,new Set),this.indices.byDate.get(s).add(e.id)}),a.getFullYear(),String(a.getMonth()+1).padStart(2,"0"),n.getFullYear(),String(n.getMonth()+1).padStart(2,"0");const r=new Date(a.getFullYear(),a.getMonth(),1);for(;r<=n;){const t=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`;this.indices.byMonth.has(t)||this.indices.byMonth.set(t,new Set),this.indices.byMonth.get(t).add(e.id),r.setMonth(r.getMonth()+1)}e.categories&&e.categories.length>0&&e.categories.forEach(t=>{this.indices.byCategory.has(t)||this.indices.byCategory.set(t,new Set),this.indices.byCategory.get(t).add(e.id)}),e.status&&(this.indices.byStatus.has(e.status)||this.indices.byStatus.set(e.status,new Set),this.indices.byStatus.get(e.status).add(e.id)),e.recurring&&this.indices.recurring.add(e.id)}_indexEventLazy(e){this.optimizer.createLazyIndexMarkers(e);const t=e.getStartInTimezone(e.timeZone),s=e.getEndInTimezone(e.endTimeZone||e.timeZone),a=i.startOfDay(t),n=i.endOfDay(s),r=new Date(a);r.setDate(r.getDate()+7);if(i.getDateRange(a,r<n?r:n).forEach(t=>{const s=i.getLocalDateString(t);this.indices.byDate.has(s)||this.indices.byDate.set(s,new Set),this.indices.byDate.get(s).add(e.id)}),n>r){const t=new Date(n);t.setDate(t.getDate()-7);i.getDateRange(t>a?t:a,n).forEach(t=>{const s=i.getLocalDateString(t);this.indices.byDate.has(s)||this.indices.byDate.set(s,new Set),this.indices.byDate.get(s).add(e.id)})}const o=new Date(a.getFullYear(),a.getMonth(),1);for(;o<=n;){const t=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`;this.indices.byMonth.has(t)||this.indices.byMonth.set(t,new Set),this.indices.byMonth.get(t).add(e.id),o.setMonth(o.getMonth()+1)}e.categories&&e.categories.length>0&&e.categories.forEach(t=>{this.indices.byCategory.has(t)||this.indices.byCategory.set(t,new Set),this.indices.byCategory.get(t).add(e.id)}),e.status&&(this.indices.byStatus.has(e.status)||this.indices.byStatus.set(e.status,new Set),this.indices.byStatus.get(e.status).add(e.id)),e.recurring&&this.indices.recurring.add(e.id)}_unindexEvent(e){for(const[t,s]of this.indices.byDate)s.delete(e.id),0===s.size&&this.indices.byDate.delete(t);for(const[t,s]of this.indices.byMonth)s.delete(e.id),0===s.size&&this.indices.byMonth.delete(t);this.indices.recurring.delete(e.id)}_notifyChange(e){for(const t of this.listeners)try{t(e)}catch(e){console.error("Error in EventStore listener:",e)}}getStats(){return{totalEvents:this.events.size,recurringEvents:this.indices.recurring.size,indexedDates:this.indices.byDate.size,indexedMonths:this.indices.byMonth.size,indexedCategories:this.indices.byCategory.size,indexedStatuses:this.indices.byStatus.size,version:this.version,performanceMetrics:this.optimizer.getMetrics()}}startBatch(e=!1){this.isBatchMode=!0,this.batchNotifications=[],e&&(this.batchBackup={events:new Map(this.events),indices:{byDate:new Map(Array.from(this.indices.byDate.entries()).map(([e,t])=>[e,new Set(t)])),byMonth:new Map(Array.from(this.indices.byMonth.entries()).map(([e,t])=>[e,new Set(t)])),recurring:new Set(this.indices.recurring),byCategory:new Map(Array.from(this.indices.byCategory.entries()).map(([e,t])=>[e,new Set(t)])),byStatus:new Map(Array.from(this.indices.byStatus.entries()).map(([e,t])=>[e,new Set(t)]))},version:this.version})}commitBatch(){this.isBatchMode&&(this.isBatchMode=!1,this.batchBackup=null,this.batchNotifications.length>0&&this._notifyChange({type:"batch",changes:this.batchNotifications,count:this.batchNotifications.length,version:++this.version}),this.batchNotifications=[])}rollbackBatch(){this.isBatchMode&&(this.isBatchMode=!1,this.batchBackup&&(this.events=this.batchBackup.events,this.indices=this.batchBackup.indices,this.version=this.batchBackup.version,this.batchBackup=null,this.optimizer.clearCache()),this.batchNotifications=[])}async executeBatch(e,t=!0){this.startBatch(t);try{const t=await e();return this.commitBatch(),t}catch(e){throw t&&this.rollbackBatch(),e}}addEvents(e){return this.optimizer.measure("addEvents",()=>{this.startBatch();const t=[],s=[];for(const i of e)try{t.push(this.addEvent(i))}catch(e){s.push({event:i,error:e.message})}return this.commitBatch(),s.length>0&&console.warn(`Failed to add ${s.length} events:`,s),t})}updateEvents(e){return this.optimizer.measure("updateEvents",()=>{this.startBatch();const t=[],s=[];for(const{id:i,updates:a}of e)try{t.push(this.updateEvent(i,a))}catch(e){s.push({id:i,error:e.message})}return this.commitBatch(),s.length>0&&console.warn(`Failed to update ${s.length} events:`,s),t})}removeEvents(e){return this.optimizer.measure("removeEvents",()=>{this.startBatch();let t=0;for(const s of e)this.removeEvent(s)&&t++;return this.commitBatch(),t})}getPerformanceMetrics(){return this.optimizer.getMetrics()}clearCaches(){this.optimizer.eventCache.clear(),this.optimizer.queryCache.clear(),this.optimizer.dateRangeCache.clear()}optimizeIndices(e){e||(e=new Date).setMonth(e.getMonth()-6),e.toDateString();let t=0;for(const[s,i]of this.indices.byDate){if(new Date(s)<e){let a=!1;for(const t of i){const s=this.events.get(t);if(s&&s.end>=e){a=!0;break}}a||(this.indices.byDate.delete(s),t++)}}return console.log(`Optimized indices: removed ${t} old date entries`),t}destroy(){this.clear(),this.optimizer.destroy(),this.listeners.clear()}checkConflicts(e,t={}){return this.conflictDetector.checkConflicts(e,t)}checkEventPairConflicts(e,t,s={}){const i=this.getEvent(e),a=this.getEvent(t);if(!i||!a)throw new Error("One or both events not found");return this.conflictDetector.checkEventPairConflicts(i,a,s)}getAllConflicts(e,t,s={}){const i=this.getEventsInRange(e,t,!1),a=[],n=new Set;for(let e=0;e<i.length;e++)for(let t=e+1;t<i.length;t++){const r=`${i[e].id}-${i[t].id}`;if(!n.has(r)){n.add(r);const o=this.conflictDetector.checkEventPairConflicts(i[e],i[t],s);a.push(...o)}}return this.conflictDetector._buildConflictSummary(a,new Set(i.map(e=>e.id)),new Set)}getBusyPeriods(e,t,s,i={}){return this.conflictDetector.getBusyPeriods(e,t,s,i)}getFreePeriods(e,t,s,i={}){return this.conflictDetector.getFreePeriods(e,t,s,i)}addEventWithConflictCheck(e,t=!0){const s=this.checkConflicts(e);if(!t&&s.hasConflicts)throw new Error(`Cannot add event: ${s.totalConflicts} conflicts detected`);return{event:this.addEvent(e),conflicts:s}}findEventsWithConflicts(e={}){const t=[],s=this.getAllEvents();for(const i of s){const s=this.checkConflicts(i,e);s.hasConflicts&&t.push({event:i,conflicts:s.conflicts})}return t}}class d{constructor(e={}){this.state={view:"month",currentDate:new Date,selectedEventId:null,selectedDate:null,hoveredEventId:null,hoveredDate:null,weekStartsOn:0,showWeekNumbers:!1,showWeekends:!0,fixedWeekCount:!0,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,locale:"en-US",hourFormat:"12h",businessHours:{start:"09:00",end:"17:00"},filters:{searchTerm:"",categories:[],showAllDay:!0,showTimed:!0},isDragging:!1,isResizing:!1,isCreating:!1,isLoading:!1,loadingMessage:"",error:null,metadata:{},...e},this.listeners=new Map,this.globalListeners=new Set,this.history=[],this.historyIndex=-1,this.maxHistorySize=50}getState(){return Object.freeze({...this.state})}get(e){return this.state[e]}setState(e){const t=this.state;"function"==typeof e&&(e=e(t));const s={...t,...e,filters:e.filters?{...t.filters,...e.filters}:t.filters,businessHours:e.businessHours?{...t.businessHours,...e.businessHours}:t.businessHours,metadata:e.metadata?{...t.metadata,...e.metadata}:t.metadata};this._hasChanged(t,s)&&(this.state=s,this._addToHistory(s),this._notifyListeners(t,s))}setView(e){const t=["month","week","day","list"];if(!t.includes(e))throw new Error(`Invalid view: ${e}. Must be one of: ${t.join(", ")}`);this.setState({view:e})}setCurrentDate(e){if(e instanceof Date||(e=new Date(e)),isNaN(e.getTime()))throw new Error("Invalid date");this.setState({currentDate:e})}navigateNext(){const{view:e,currentDate:t}=this.state,s=new Date(t);switch(e){case"month":s.setMonth(s.getMonth()+1);break;case"week":s.setDate(s.getDate()+7);break;case"day":s.setDate(s.getDate()+1)}this.setCurrentDate(s)}navigatePrevious(){const{view:e,currentDate:t}=this.state,s=new Date(t);switch(e){case"month":s.setMonth(s.getMonth()-1);break;case"week":s.setDate(s.getDate()-7);break;case"day":s.setDate(s.getDate()-1)}this.setCurrentDate(s)}navigateToday(){this.setCurrentDate(new Date)}selectEvent(e){this.setState({selectedEventId:e})}clearEventSelection(){this.setState({selectedEventId:null})}selectDate(e){e instanceof Date||(e=new Date(e)),this.setState({selectedDate:e})}clearDateSelection(){this.setState({selectedDate:null})}setLoading(e,t=""){this.setState({isLoading:e,loadingMessage:t})}setError(e){this.setState({error:e?e instanceof Error?e.message:e:null})}updateFilters(e){this.setState({filters:{...this.state.filters,...e}})}subscribe(e){return this.globalListeners.add(e),()=>{this.globalListeners.delete(e)}}watch(e,t){const s=Array.isArray(e)?e:[e];return s.forEach(e=>{this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}),()=>{s.forEach(e=>{const s=this.listeners.get(e);s&&(s.delete(t),0===s.size&&this.listeners.delete(e))})}}canUndo(){return this.historyIndex>0}canRedo(){return this.historyIndex<this.history.length-1}getUndoCount(){return this.historyIndex}getRedoCount(){return this.history.length-1-this.historyIndex}undo(){if(!this.canUndo())return!1;this.historyIndex--;const e=this.history[this.historyIndex],t=this.state;return this.state={...e},this._notifyListeners(t,this.state),!0}redo(){if(!this.canRedo())return!1;this.historyIndex++;const e=this.history[this.historyIndex],t=this.state;return this.state={...e},this._notifyListeners(t,this.state),!0}reset(){const e=this.history[0]||{};this.setState(e),this.history=[e],this.historyIndex=0}_hasChanged(e,t){return!this._deepEqual(e,t)}_deepEqual(e,t,s=new Set){if(e===t)return!0;if(null==e||null==t)return e===t;if(typeof e!=typeof t)return!1;if("object"!=typeof e)return e===t;if(s.has(e)||s.has(t))return!1;if(s.add(e),s.add(t),Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return s.delete(e),s.delete(t),!1;for(let i=0;i<e.length;i++)if(!this._deepEqual(e[i],t[i],s))return s.delete(e),s.delete(t),!1;return s.delete(e),s.delete(t),!0}if(e instanceof Date&&t instanceof Date){const i=e.getTime()===t.getTime();return s.delete(e),s.delete(t),i}const i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return s.delete(e),s.delete(t),!1;i.sort(),a.sort();for(let n=0;n<i.length;n++)if(i[n]!==a[n])return s.delete(e),s.delete(t),!1;for(const a of i)if(!this._deepEqual(e[a],t[a],s))return s.delete(e),s.delete(t),!1;return s.delete(e),s.delete(t),!0}_addToHistory(e){this.historyIndex<this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1)),this.history.push({...e}),this.historyIndex++,this.history.length>this.maxHistorySize&&(this.history.shift(),this.historyIndex--)}_notifyListeners(e,t){for(const s of this.globalListeners)try{s(t,e)}catch(e){console.error("Error in state listener:",e)}for(const[s,i]of this.listeners)if(e[s]!==t[s])for(const a of i)try{a(t[s],e[s],t,e)}catch(e){console.error(`Error in state listener for key "${s}":`,e)}}}class u{constructor(e={}){this.timezoneManager=new t,this.config={view:"month",date:new Date,weekStartsOn:0,locale:"en-US",timeZone:e.timeZone||this.timezoneManager.getSystemTimezone(),showWeekNumbers:!1,showWeekends:!0,fixedWeekCount:!0,businessHours:{start:"09:00",end:"17:00"},...e},this.eventStore=new l({timezone:this.config.timeZone}),this.state=new d({view:this.config.view,currentDate:this.config.date,weekStartsOn:this.config.weekStartsOn,locale:this.config.locale,timeZone:this.config.timeZone,showWeekNumbers:this.config.showWeekNumbers,showWeekends:this.config.showWeekends,fixedWeekCount:this.config.fixedWeekCount,businessHours:this.config.businessHours}),this.listeners=new Map,this.plugins=new Set,this.views=new Map,this._setupInternalListeners(),e.events&&this.setEvents(e.events)}setView(e,t=null){this.state.setView(e),t&&this.state.setCurrentDate(t),this._emit("viewChange",{view:e,date:t||this.state.get("currentDate")})}getView(){return this.state.get("view")}next(){this.state.navigateNext(),this._emit("navigate",{direction:"next",date:this.state.get("currentDate"),view:this.state.get("view")})}previous(){this.state.navigatePrevious(),this._emit("navigate",{direction:"previous",date:this.state.get("currentDate"),view:this.state.get("view")})}today(){this.state.navigateToday(),this._emit("navigate",{direction:"today",date:this.state.get("currentDate"),view:this.state.get("view")})}goToDate(e){this.state.setCurrentDate(e),this._emit("navigate",{direction:"goto",date:e,view:this.state.get("view")})}getCurrentDate(){return new Date(this.state.get("currentDate"))}addEvent(e){e instanceof s||e.timeZone||(e={...e,timeZone:this.config.timeZone});const t=this.eventStore.addEvent(e);return this._emit("eventAdd",{event:t}),t}updateEvent(e,t){const s=this.eventStore.getEvent(e),i=this.eventStore.updateEvent(e,t);return this._emit("eventUpdate",{event:i,oldEvent:s}),i}removeEvent(e){const t=this.eventStore.getEvent(e),s=this.eventStore.removeEvent(e);return s&&this._emit("eventRemove",{event:t}),s}getEvent(e){return this.eventStore.getEvent(e)}getEvents(){return this.eventStore.getAllEvents()}setEvents(e){this.eventStore.loadEvents(e),this._emit("eventsSet",{events:this.getEvents()})}queryEvents(e){return this.eventStore.queryEvents(e)}getEventsForDate(e,t=null){return this.eventStore.getEventsForDate(e,t||this.config.timeZone)}getEventsInRange(e,t,s=null){return this.eventStore.getEventsInRange(e,t,!0,s||this.config.timeZone)}setTimezone(e){const t=this.timezoneManager.parseTimezone(e),s=this.config.timeZone;this.config.timeZone=t,this.eventStore.defaultTimezone=t,this.state.setState({timeZone:t}),this._emit("timezoneChange",{timezone:t,previousTimezone:s})}getTimezone(){return this.config.timeZone}convertTimezone(e,t,s){return this.timezoneManager.convertTimezone(e,t,s)}toCalendarTimezone(e,t){return this.timezoneManager.convertTimezone(e,t,this.config.timeZone)}fromCalendarTimezone(e,t){return this.timezoneManager.convertTimezone(e,this.config.timeZone,t)}formatInTimezone(e,t=null,s={}){return this.timezoneManager.formatInTimezone(e,t||this.config.timeZone,s)}getTimezones(){return this.timezoneManager.getCommonTimezones()}getOverlapGroups(e,t=!0){return this.eventStore.getOverlapGroups(e,t)}calculateEventPositions(e){return this.eventStore.calculateEventPositions(e)}getViewData(){const e=this.state.get("view"),t=this.state.get("currentDate");switch(e){case"month":return this._getMonthViewData(t);case"week":return this._getWeekViewData(t);case"day":return this._getDayViewData(t);case"list":return this._getListViewData(t);default:return null}}_getMonthViewData(e){const t=e.getFullYear(),s=e.getMonth(),a=this.state.get("weekStartsOn"),n=this.state.get("fixedWeekCount"),r=new Date(t,s,1),o=new Date(t,s+1,0),c=i.startOfWeek(r,a),h=[];let l=new Date(c);const d=n?6:Math.ceil((o.getDate()+i.getDayOfWeek(r,a))/7);for(let e=0;e<d;e++){const e={weekNumber:i.getWeekNumber(l),days:[]};for(let t=0;t<7;t++){const t=new Date(l),a=t.getMonth()===s,n=i.isToday(t),r=0===t.getDay()||6===t.getDay();e.days.push({date:t,dayOfMonth:t.getDate(),isCurrentMonth:a,isToday:n,isWeekend:r,events:this.getEventsForDate(t)}),l=i.addDays(l,1)}h.push(e)}return{type:"month",year:t,month:s,monthName:i.getMonthName(e,this.state.get("locale")),weeks:h,startDate:c,endDate:new Date(l.getTime()-1)}}_getWeekViewData(e){const t=this.state.get("weekStartsOn"),s=i.startOfWeek(e,t),a=i.endOfWeek(e,t),n=[],r=new Date(s);for(let e=0;e<7;e++){const e=new Date(r);n.push({date:e,dayOfMonth:e.getDate(),dayOfWeek:e.getDay(),dayName:i.getDayName(e,this.state.get("locale")),isToday:i.isToday(e),isWeekend:0===e.getDay()||6===e.getDay(),events:this.getEventsForDate(e),overlapGroups:this.eventStore.getOverlapGroups(e,!0),getEventPositions:e=>this.eventStore.calculateEventPositions(e)}),r.setDate(r.getDate()+1)}return{type:"week",weekNumber:i.getWeekNumber(s),startDate:s,endDate:a,days:n}}_getDayViewData(e){const t=this.getEventsForDate(e),s=t.filter(e=>e.allDay),a=t.filter(e=>!e.allDay),n=[];for(let t=0;t<24;t++){const s=new Date(e);s.setHours(t,0,0,0);const r=new Date(e);r.setHours(t+1,0,0,0),n.push({hour:t,time:i.formatTime(s,this.state.get("locale")),events:a.filter(e=>e.start<r&&e.end>s)})}return{type:"day",date:e,dayName:i.getDayName(e,this.state.get("locale")),isToday:i.isToday(e),allDayEvents:s,hours:n}}_getListViewData(e){const t=new Date(e);t.setHours(0,0,0,0);const s=new Date(t);s.setDate(s.getDate()+30);const a=this.getEventsInRange(t,s),n=new Map;a.forEach(e=>{const t=e.start.toDateString();n.has(t)||n.set(t,{date:new Date(e.start),events:[]}),n.get(t).events.push(e)});return{type:"list",startDate:t,endDate:s,days:Array.from(n.values()).sort((e,t)=>e.date-t.date).map(e=>({...e,dayName:i.getDayName(e.date,this.state.get("locale")),isToday:i.isToday(e.date)})),totalEvents:a.length}}selectEvent(e){const t=this.getEvent(e);t&&(this.state.selectEvent(e),this._emit("eventSelect",{event:t}))}clearEventSelection(){const e=this.state.get("selectedEventId");this.state.clearEventSelection(),e&&this._emit("eventDeselect",{eventId:e})}selectDate(e){this.state.selectDate(e),this._emit("dateSelect",{date:e})}clearDateSelection(){const e=this.state.get("selectedDate");this.state.clearDateSelection(),e&&this._emit("dateDeselect",{date:e})}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>this.off(e,t)}off(e,t){const s=this.listeners.get(e);s&&(s.delete(t),0===s.size&&this.listeners.delete(e))}_emit(e,t){const s=this.listeners.get(e);s&&s.forEach(s=>{try{s(t)}catch(t){console.error(`Error in event listener for "${e}":`,t)}})}_setupInternalListeners(){this.state.subscribe((e,t)=>{this._emit("stateChange",{newState:e,oldState:t})}),this.eventStore.subscribe(e=>{this._emit("eventStoreChange",e)})}use(e){if(this.plugins.has(e))console.warn("Plugin already installed");else{if("function"!=typeof e.install)throw new Error("Plugin must have an install method");e.install(this),this.plugins.add(e)}}destroy(){this.listeners.clear(),this.eventStore.clear(),this.plugins.forEach(e=>{"function"==typeof e.uninstall&&e.uninstall(this)}),this.plugins.clear(),this._emit("destroy")}}const m="0.1.0";export{u as Calendar,i as DateUtils,s as Event,l as EventStore,d as StateManager,m as VERSION,u as default};
//# sourceMappingURL=calendar-core.esm.min.js.map
